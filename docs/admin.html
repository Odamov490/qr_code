<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin — QR & PDF</title>

  <!-- Stil -->
  <link rel="stylesheet" href="assets/style.css">

  <!-- QRCode kutubxonasi (MUHIM) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
          crossorigin="anonymous"></script>
</head>

<body>
<main class="container">
  <div class="card">

    <div class="row">
      <h1>Admin</h1>
      <a class="btn secondary" href="index.html">Ro‘yxat</a>
    </div>

    <!-- ID -->
    <label>ID</label>
    <input id="docId" placeholder="Masalan: NX5">

    <!-- PDF -->
    <label>PDF faylni tanlang</label>
    <input type="file" id="pdfFile" accept="application/pdf">

    <!-- Token -->
    <label>GitHub Token</label>
    <input id="token" type="password" placeholder="GitHub token">

    <div style="height:12px"></div>

    <div class="row">
      <button class="btn" onclick="showQR()">QR ko‘rsatish</button>
      <button class="btn secondary" onclick="downloadQR()">QR PNG</button>
    </div>

    <div id="status" class="muted" style="margin-top:10px"></div>

    <hr style="margin:20px 0">

    <!-- QR -->
    <div>
      <b>QR link</b>
      <div id="qrLink" class="mono"></div>
      <div id="qr" style="margin-top:12px"></div>
    </div>

  </div>
</main>

<script>
let qrInstance = null;

function makeLink(id) {
  return location.origin + location.pathname.replace('admin.html','') +
         'p.html?id=' + encodeURIComponent(id);
}

function showQR() {
  const id = document.getElementById('docId').value.trim();
  if (!id) {
    alert('ID kiriting');
    return;
  }

  const link = makeLink(id);
  document.getElementById('qrLink').textContent = link;

  const qrBox = document.getElementById('qr');
  qrBox.innerHTML = '';

  qrInstance = new QRCode(qrBox, {
    text: link,
    width: 220,
    height: 220
  });

  document.getElementById('status').textContent = 'QR tayyor';
}

function downloadQR() {
  if (!qrInstance) {
    alert('Avval QR yarating');
    return;
  }

  const img = document.querySelector('#qr img');
  const canvas = document.querySelector('#qr canvas');
  const dataUrl = img ? img.src : canvas.toDataURL('image/png');

  const a = document.createElement('a');
  a.href = dataUrl;
  a.download = (document.getElementById('docId').value || 'qr') + '.png';
  a.click();
}
</script>
</body>
</html>
